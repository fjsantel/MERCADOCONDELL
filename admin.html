<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administraci√≥n - Mercado Condell</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin-styles.css">
    <link href="https://api.fontshare.com/v2/css?f[]=author@400,700&display=swap" rel="stylesheet">
</head>
<body class="admin-body">
    <!-- Breakpoint Markers (hidden by default) -->
    <div id="bpMarkers" class="bp-markers-container">
        <div class="bp-marker desktop">Desktop (>1200px)</div>
        <div class="bp-marker tablet">Tablet (‚â§1200px)</div>
        <div class="bp-marker mobile">Mobile (‚â§768px)</div>
        <div class="bp-marker small-mobile">Small Mobile (‚â§480px)</div>
        <div class="bp-marker extra-small">Extra Small (‚â§380px)</div>
    </div>
    
    <!-- Toggle Button (hidden by default) -->
    <button id="bpToggle" class="bp-toggle hidden" onclick="toggleBpMarkers()">BP</button>
    
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <img src="assets/Logo-02.svg" alt="Mercado Condell" class="login-logo">
            <h2>Administraci√≥n</h2>
            <form id="loginForm" class="login-form">
                <input type="password" id="adminPassword" placeholder="Contrase√±a de administrador" required>
                <button type="submit" class="login-button">INGRESAR</button>
            </form>
            <div id="loginError" class="login-error" style="display: none;">
                Contrase√±a incorrecta. Intenta nuevamente.
            </div>
        </div>
    </div>

    <!-- Main Admin Interface (hidden initially) -->
    <div id="adminInterface" class="main-container" style="display: none;">
        <!-- Header Section -->
        <header class="header">
            <div class="header-left">
                <img src="assets/Logo-02.svg" alt="Mercado Condell" class="logo-svg">
            </div>
            <div class="header-center">
                <h1 class="admin-title">PANEL DE ADMINISTRACI√ìN</h1>
            </div>
            <div class="header-right">
                <div class="menu-container">
                    <button class="menu-button" onclick="toggleMenu()">MEN√ö</button>
                    <div class="menu-dropdown" id="menuDropdown">
                        <a href="#gestionar" class="menu-item">Gestionar Negocios</a>
                        <a href="#imagenes" class="menu-item">Subir Im√°genes</a>
                        <a href="#configuracion" class="menu-item">Configuraci√≥n</a>
                        <a href="index.html" class="menu-item">Ver Sitio</a>
                        <a href="#" onclick="logout()" class="menu-item">Cerrar Sesi√≥n</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Admin Content Section -->
        <section class="admin-content">
            <div class="admin-content-container">
                <!-- Left Panel: Store List -->
                <div class="admin-left-panel">
                    <h3>Negocios</h3>
                    <div class="store-list" id="storeList">
                        <!-- Store items will be populated here -->
                    </div>
                    <button class="add-store-btn" onclick="addNewStore()">+ AGREGAR NEGOCIO</button>
                </div>

                <!-- Center Panel: Store Editor -->
                <div class="admin-center-panel">
                    <div id="noStoreSelected" class="no-selection">
                        <h3>Selecciona un negocio para editar</h3>
                        <p>Elige un negocio de la lista de la izquierda para comenzar a editar su informaci√≥n.</p>
                    </div>
                    
                    <div id="storeEditor" class="store-editor" style="display: none;">
                        <form id="storeEditForm" class="edit-form">
                            <div class="form-group">
                                <label for="editStoreName">Nombre del Negocio:</label>
                                <input type="text" id="editStoreName" name="storeName" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="editStoreCategory">Categor√≠a:</label>
                                <select id="editStoreCategory" name="category" required>
                                    <option value="alimentos">Alimentos</option>
                                    <option value="ropa">Ropa</option>
                                    <option value="musica">M√∫sica</option>
                                    <option value="decoracion">Decoraci√≥n</option>
                                    <option value="cultura">Cultura</option>
                                    <option value="artesanias">Artesan√≠as</option>
                                    <option value="tecnologia">Tecnolog√≠a</option>
                                    <option value="belleza">Belleza</option>
                                    <option value="juguetes">Juguetes</option>
                                    <option value="hogar">Hogar</option>
                                    <option value="servicios">Servicios</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="editStoreDescription">Descripci√≥n:</label>
                                <textarea id="editStoreDescription" name="description" rows="4" required></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="save-btn">GUARDAR CAMBIOS</button>
                                <button type="button" class="cancel-btn" onclick="cancelEdit()">CANCELAR</button>
                                <button type="button" class="delete-btn" onclick="deleteStore()">ELIMINAR</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Right Panel: Image Upload -->
                <div class="admin-right-panel">
                    <h3>Gesti√≥n de Im√°genes</h3>
                    
                    <div class="image-upload-section">
                        <h4>Subir Nueva Imagen</h4>
                        <div class="drop-zone" id="imageDropZone">
                            <div class="drop-zone-content">
                                <div class="drop-icon">üìÅ</div>
                                <p>Arrastra una imagen aqu√≠ o <span class="browse-link">busca archivos</span></p>
                                <p class="drop-zone-hint">Formatos: JPG, PNG, SVG (m√°x. 5MB)</p>
                            </div>
                            <input type="file" id="imageFileInput" accept="image/*" style="display: none;">
                        </div>
                        
                        <div class="uploaded-image-preview" id="imagePreview" style="display: none;">
                            <img id="previewImg" src="" alt="Vista previa">
                            <div class="image-info">
                                <p id="imageFileName"></p>
                                <button class="upload-btn" onclick="uploadImage()">SUBIR IMAGEN</button>
                                <button class="remove-btn" onclick="clearImagePreview()">QUITAR</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="current-images-section">
                        <h4>Im√°genes Actuales</h4>
                        <div class="images-grid" id="currentImages">
                            <div class="image-item">
                                <img src="assets/Logo-02.svg" alt="Logo">
                                <p>Logo-02.svg</p>
                            </div>
                            <div class="image-item">
                                <img src="assets/mapa v1.svg" alt="Mapa">
                                <p>mapa v1.svg</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Admin password (in production, this should be handled server-side)
        const ADMIN_PASSWORD = 'mercadocondell2024';
        let currentEditingStore = null;
        let selectedFile = null;

        // Store data - copy from main site
        let storeData = {
            1: {
                name: "CAF√â MERCADO",
                category: "alimentos",
                description: "Acogedora cafeter√≠a especializada en caf√© de especialidad y reposter√≠a artesanal. Ideal para comenzar el d√≠a o tomar un descanso con productos frescos y de origen local."
            },
            2: {
                name: "DELICIAS DEL MAR",
                category: "alimentos",
                description: "Restaurante de mariscos frescos que ofrece lo mejor de la costa chilena. Especialidad en ceviches, empanadas de mariscos y pescados a la plancha con vista al mercado."
            },
            3: {
                name: "FRUTAS Y VERDURAS EL HUERTO",
                category: "alimentos",
                description: "Puesto de frutas y verduras frescas seleccionadas diariamente desde los mejores campos de la regi√≥n. Productos org√°nicos y de temporada a precios accesibles."
            },
            4: {
                name: "CARNES SELECTAS DON JOS√â",
                category: "alimentos",
                description: "Carnicer√≠a tradicional con m√°s de 30 a√±os de experiencia. Ofrece cortes premium, embutidos caseros y preparaciones especiales para asados y ocasiones especiales."
            },
            5: {
                name: "PANADER√çA ARTESANAL",
                category: "alimentos",
                description: "Pan reci√©n horneado cada ma√±ana con recetas tradicionales y t√©cnicas artesanales. Especialidad en pan amasado, sopaipillas y empanadas horneadas."
            },
            6: {
                name: "ESPECIAS DEL MUNDO",
                category: "alimentos",
                description: "Tienda especializada en especias, hierbas y condimentos de todas partes del mundo. Productos √∫nicos para dar sabor aut√©ntico a tus preparaciones culinarias."
            },
            7: {
                name: "L√ÅCTEOS LA GRANJA",
                category: "alimentos",
                description: "Productos l√°cteos frescos directamente desde productores locales. Quesos artesanales, leche fresca, mantequilla y yogures naturales sin aditivos artificiales."
            },
            8: {
                name: "FLORES Y PLANTAS JARD√çN",
                category: "decoracion",
                description: "Florister√≠a con gran variedad de flores frescas y plantas ornamentales. Arreglos para ocasiones especiales y asesor√≠a en jardiner√≠a dom√©stica."
            },
            9: {
                name: "ROPA Y ACCESORIOS ESTILO",
                category: "ropa",
                description: "Boutique de moda con prendas casuales y elegantes para toda la familia. Accesorios √∫nicos y ropa de dise√±adores locales con estilo contempor√°neo."
            },
            10: {
                name: "LIBRER√çA Y PAPELER√çA CULTURAL",
                category: "cultura",
                description: "Espacio dedicado a la cultura con libros, revistas, material de oficina y art√≠culos de papeler√≠a. Punto de encuentro para amantes de la lectura y la escritura."
            },
            11: {
                name: "JUGOS NATURALES VITA",
                category: "alimentos",
                description: "Bar de jugos y batidos naturales preparados al momento con frutas frescas. Opciones detox, energizantes y smoothies nutritivos para una vida saludable."
            },
            12: {
                name: "ARTESAN√çAS LOCALES",
                category: "artesanias",
                description: "Exposici√≥n y venta de artesan√≠as tradicionales chilenas realizadas por artesanos locales. Productos √∫nicos que reflejan la cultura y tradici√≥n de nuestra regi√≥n."
            },
            13: {
                name: "ELECTR√ìNICOS TECH STORE",
                category: "tecnologia",
                description: "Tienda de tecnolog√≠a con los √∫ltimos dispositivos, accesorios y servicio t√©cnico especializado. Atenci√≥n personalizada y garant√≠a en todos los productos."
            },
            14: {
                name: "PERFUMER√çA ESENCIA",
                category: "belleza",
                description: "Productos de belleza y cuidado personal de marcas reconocidas. Perfumes, cosm√©ticos y tratamientos para el cuidado de la piel con asesor√≠a especializada."
            },
            15: {
                name: "JUGUETER√çA FANTAS√çA",
                category: "juguetes",
                description: "Mundo m√°gico lleno de juguetes educativos, did√°cticos y de entretenimiento para ni√±os de todas las edades. Productos que estimulan la creatividad y el aprendizaje."
            },
            16: {
                name: "FERRETER√çA EL MARTILLO",
                category: "hogar",
                description: "Herramientas, materiales de construcci√≥n y art√≠culos para el hogar. Todo lo necesario para reparaciones dom√©sticas y proyectos de mejoramiento del hogar."
            },
            17: {
                name: "ANTIG√úEDADES Y VINTAGE",
                category: "decoracion",
                description: "Colecci√≥n de objetos antiguos, muebles vintage y art√≠culos de colecci√≥n. Tesoros √∫nicos con historia que agregan car√°cter especial a cualquier espacio."
            },
            18: {
                name: "COMIDA INTERNACIONAL",
                category: "alimentos",
                description: "Restaurante que ofrece sabores del mundo con platos t√≠picos de diferentes culturas. Fusi√≥n gastron√≥mica que celebra la diversidad culinaria internacional."
            },
            19: {
                name: "SERVICIOS GENERALES",
                category: "servicios",
                description: "Centro de servicios m√∫ltiples que incluye cobro de cuentas, env√≠o de encomiendas, fotocopias y tr√°mites diversos. Soluciones pr√°cticas para el d√≠a a d√≠a."
            },
            20: {
                name: "MERCADO NOCTURNO",
                category: "musica",
                description: "Espacio gastron√≥mico que cobra vida al atardecer con food trucks, m√∫sica en vivo y ambiente bohemio. Ideal para disfrutar de la noche con sabores √∫nicos y entretenimiento."
            }
        };

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminInterface').style.display = 'block';
                loadStoreList();
            } else {
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('adminPassword').value = '';
            }
        });

        // Logout functionality
        function logout() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminInterface').style.display = 'none';
            document.getElementById('adminPassword').value = '';
            document.getElementById('loginError').style.display = 'none';
        }

        // Load store list
        function loadStoreList() {
            const storeList = document.getElementById('storeList');
            storeList.innerHTML = '';
            
            for (let id in storeData) {
                const store = storeData[id];
                const storeItem = document.createElement('div');
                storeItem.className = 'store-item';
                storeItem.innerHTML = `
                    <div class="store-item-number">${id}</div>
                    <div class="store-item-info">
                        <div class="store-item-name">${store.name}</div>
                        <div class="store-item-category">${store.category}</div>
                    </div>
                `;
                storeItem.addEventListener('click', () => editStore(id));
                storeList.appendChild(storeItem);
            }
        }

        // Edit store
        function editStore(storeId) {
            currentEditingStore = storeId;
            const store = storeData[storeId];
            
            // Update UI
            document.getElementById('noStoreSelected').style.display = 'none';
            document.getElementById('storeEditor').style.display = 'block';
            
            // Populate form
            document.getElementById('editStoreName').value = store.name;
            document.getElementById('editStoreCategory').value = store.category;
            document.getElementById('editStoreDescription').value = store.description;
            
            // Highlight selected store
            const storeItems = document.querySelectorAll('.store-item');
            storeItems.forEach(item => item.classList.remove('active'));
            storeItems[storeId - 1].classList.add('active');
        }

        // Save store changes
        document.getElementById('storeEditForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (currentEditingStore) {
                const formData = new FormData(e.target);
                storeData[currentEditingStore] = {
                    name: formData.get('storeName').toUpperCase(),
                    category: formData.get('category'),
                    description: formData.get('description')
                };
                
                // Update localStorage
                localStorage.setItem('storeData', JSON.stringify(storeData));
                
                // Reload store list
                loadStoreList();
                
                // Show success message
                showNotification('Cambios guardados exitosamente', 'success');
                
                // Re-select the current store
                setTimeout(() => editStore(currentEditingStore), 100);
            }
        });

        // Cancel edit
        function cancelEdit() {
            document.getElementById('noStoreSelected').style.display = 'block';
            document.getElementById('storeEditor').style.display = 'none';
            currentEditingStore = null;
            
            // Remove active class from all store items
            const storeItems = document.querySelectorAll('.store-item');
            storeItems.forEach(item => item.classList.remove('active'));
        }

        // Delete store
        function deleteStore() {
            if (currentEditingStore && confirm('¬øEst√°s seguro de que quieres eliminar este negocio?')) {
                delete storeData[currentEditingStore];
                localStorage.setItem('storeData', JSON.stringify(storeData));
                loadStoreList();
                cancelEdit();
                showNotification('Negocio eliminado exitosamente', 'success');
            }
        }

        // Add new store
        function addNewStore() {
            const newId = Math.max(...Object.keys(storeData).map(Number)) + 1;
            storeData[newId] = {
                name: "NUEVO NEGOCIO",
                category: "alimentos",
                description: "Descripci√≥n del nuevo negocio."
            };
            loadStoreList();
            editStore(newId);
        }

        // Image upload functionality
        function setupImageUpload() {
            const dropZone = document.getElementById('imageDropZone');
            const fileInput = document.getElementById('imageFileInput');
            const browseLink = document.querySelector('.browse-link');

            // Click to browse
            browseLink.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('click', (e) => {
                if (e.target === dropZone || e.target.className === 'drop-zone-content') {
                    fileInput.click();
                }
            });

            // Drag and drop
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });

            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelection(files[0]);
                }
            });

            // File input change
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelection(e.target.files[0]);
                }
            });
        }

        // Handle file selection
        function handleFileSelection(file) {
            if (!file.type.startsWith('image/')) {
                showNotification('Por favor selecciona un archivo de imagen v√°lido', 'error');
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                showNotification('El archivo es demasiado grande. M√°ximo 5MB', 'error');
                return;
            }

            selectedFile = file;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('previewImg').src = e.target.result;
                document.getElementById('imageFileName').textContent = file.name;
                document.getElementById('imagePreview').style.display = 'block';
                document.getElementById('imageDropZone').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        // Upload image
        function uploadImage() {
            if (selectedFile) {
                // Simulate upload
                showNotification('Imagen subida exitosamente', 'success');
                clearImagePreview();
                
                // Add to current images grid
                const imagesGrid = document.getElementById('currentImages');
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                imageItem.innerHTML = `
                    <img src="${URL.createObjectURL(selectedFile)}" alt="${selectedFile.name}">
                    <p>${selectedFile.name}</p>
                `;
                imagesGrid.appendChild(imageItem);
            }
        }

        // Clear image preview
        function clearImagePreview() {
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('imageDropZone').style.display = 'block';
            document.getElementById('imageFileInput').value = '';
            selectedFile = null;
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Menu functionality
        function toggleMenu() {
            const dropdown = document.getElementById('menuDropdown');
            const button = document.querySelector('.menu-button');
            
            dropdown.classList.toggle('show');
            button.classList.toggle('active');
        }

        // Toggle breakpoint markers
        function toggleBpMarkers() {
            const markers = document.getElementById('bpMarkers');
            const button = document.getElementById('bpToggle');
            
            markers.classList.toggle('show');
            button.classList.toggle('active');
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menuContainer = document.querySelector('.menu-container');
            const dropdown = document.getElementById('menuDropdown');
            const button = document.querySelector('.menu-button');
            
            if (!menuContainer.contains(event.target)) {
                dropdown.classList.remove('show');
                button.classList.remove('active');
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupImageUpload();
            
            // Load data from localStorage if available
            const savedData = localStorage.getItem('storeData');
            if (savedData) {
                storeData = JSON.parse(savedData);
            }
        });
    </script>
</body>
</html>